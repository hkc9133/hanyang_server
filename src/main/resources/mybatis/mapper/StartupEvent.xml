<?xml version="1.0" encoding="UTF-8"?> <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="startup_event">

<!--    <insert id="addAttachFile" parameterType="com.hanyang.startup.hanyangstartup.resource.domain.AttachFile">-->
<!--        INSERT INTO attach_file(content_id, status, file_size, division, file_origin_name, file_name, file_path, file_extension) values(#{contentId},#{status}, #{fileSize},#{division},#{fileOriginName},#{fileName},#{filePath},#{fileExtension})-->
<!--        <selectKey keyProperty="fileId" resultType="int" order="AFTER">-->
<!--            SELECT LAST_INSERT_ID()-->
<!--        </selectKey>-->
<!--    </insert>-->
    <select id="getStartupEventList" parameterType="com.hanyang.startup.hanyangstartup.startupEvent.domain.StartupEvent" resultType="com.hanyang.startup.hanyangstartup.startupEvent.domain.StartupEvent">
        SELECT ROW_NUMBER() OVER (ORDER BY a.event_id) rownum, a.* from startup_event as a
        <where>
            <if test="categoryCodeId != null and categoryCodeId != ''">
                AND category_code_id = #{categoryCodeId}
            </if>
            <if test="searchField != null and searchField != '' and searchValue != null and searchValue != ''">
                AND ${searchField} like '%' #{searchValue} '%'
            </if>
            <if test="date != null and date != ''">
                AND DATE_FORMAT(apply_start_date, '%Y-%m') = #{date}
                AND DATE_FORMAT(apply_end_date, '%Y-%m') = #{date}
                AND DATE_FORMAT(event_date, '%Y-%m') = #{date}
            </if>
        </where>
        order by a.event_id desc
        <if test="pageNo != null and pageNo !=-1 and pageNo != '' and startDate == null and endDate == null">
            limit #{startRowNo}, #{pageSize}
        </if>
    </select>

    <select id="getStartupEventListCnt" parameterType="com.hanyang.startup.hanyangstartup.startupEvent.domain.StartupEvent" resultType="java.lang.Integer">
        SELECT count(*) from startup_event as a
        <where>
            <if test="categoryCodeId != null and categoryCodeId != ''">
                AND category_code_id = #{categoryCodeId}
            </if>
            <if test="searchField != null and searchField != '' and searchValue != null and searchValue != ''">
                AND ${searchField} like '%' #{searchValue} '%'
            </if>
            <if test="startDate != null">
                AND <![CDATA[date(reg_date) >= #{startDate}]]>
            </if>
            <if test="endDate != null">
                AND <![CDATA[date(reg_date) <= #{endDate}]]>
            </if>
        </where>
    </select>

    <select id="getStartupEventCategoryCodeList" resultType="com.hanyang.startup.hanyangstartup.startupEvent.domain.StartupEventCategoryCode">
        SELECT * FROM startup_event_category_code
    </select>
</mapper>
